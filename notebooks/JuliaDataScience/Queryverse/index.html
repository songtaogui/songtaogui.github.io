
<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="sKCEBeALSs13uui0cWMviq9hlm0rPByKQKNHnOdq-d0" />
    <meta name="baidu-site-verification" content="code-MBwKQgVpns" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Songtao Gui">

    
    <meta name="description" content="学习 Queryverse 系列工具使用
">
    

    
    
    <meta name="keywords" content="Julia数据科学系列-Queryverse系列包">
    <title>Julia数据科学系列-Queryverse系列包</title>
    

    <link rel="icon" href="/assets/favicon.svg">

    
<link rel=preconnect href="https://fonts.gstatic.com" crossorigin=anonymous>
<link rel=stylesheet href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    crossorigin=anonymous>
<link rel=stylesheet href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css"
    crossorigin=anonymous>
<link rel=stylesheet href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" crossorigin=anonymous>
<link rel=stylesheet
    href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap"
    crossorigin=anonymous>
<!-- locally served -->
<link rel="stylesheet" href="/css/pure.css">
<link rel=stylesheet href="/libs/academic/academic.min.css">
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/extra.css">
<link rel=stylesheet href="/css/codeset.css">
<link rel=stylesheet href="/css/admonition.css">
<link rel=stylesheet href="/css/cv.css">
<link rel=stylesheet href="/css/search-box.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
<link rel=stylesheet href="/css/vega.css">
<!-- <link rel=stylesheet href="/css/font-awesome.css"> -->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- nutshell + highlight + katex + plotly -->

<link rel=stylesheet href="/libs/highlight/styles/atom-one-light.min.css">






    <!-- Vega -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.0/dist/svg.min.js"></script>
    <style media="screen">
        /* Add space between Vega-Embed links  */
        .vega-actions a {
          margin-right: 5px;
        }
    </style>
    <!-- end Vega -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js"
        integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin=anonymous async></script>
</head>

<body id=top data-spy="scroll" data-offset="70" data-target=#navbar-main>
    <!-- Swiftype -->
    <script type="text/javascript">
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
        (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
        
        _st('install','J57vdqtTa8oYL-ikpKNG','2.0.0');
    </script>
    
     <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main>
    <div class=container>
        <!-- Main name -->
        <div class="d-none d-lg-inline-flex">
            <a class=navbar-brand href="/">Songtao Gui</a>
        </div>
        <!-- Button for narrow mode -->
        <button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar
            aria-expanded=false aria-label="Toggle navigation">
            <span><i class="fas fa-bars"></i></span>
        </button>
        <!-- Main name for mobile mode -->
        <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
            <a class=navbar-brand href="/">Songtao Gui</a>
        </div>
        <!-- Menu items -->
        <div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content>
            <ul class="navbar-nav d-md-inline-flex">
                <li class=nav-item><a class=nav-link href="/posts/"><span>Posts</span></a></li>
                <li class=nav-item><a class=nav-link href="/courses/"><span>Courses</span></a></li>
                <li class=nav-item><a class=nav-link href="/notebooks/"><span>Notebooks</span></a></li>
                <li class=nav-item><a class=nav-link href="/cv/"><span>CurriculumVitae</span></a></li>
                <li class=nav-item><a class=nav-link href="/tag/"><span>Tags</span></a></li>
            </ul>
        </div>
        <!-- <div class="nav-linksmall d-none d-lg-inline-flex inputBox">
                <input type="text" class="st-default-search-input" placeholder="Input then press ENTER" value="" required>
                <div class="search"></div>
            <script>
                var searchForm = document.getElementById('searchForm');
                searchForm.onsubmit = function () {
                    var url = this.action;
                    var q = this.children['q'].value;
                    var q = 'site:songtaogui.github.io+' + q
                    // var site = this.children['site'].value;
                    var url = url + '?q=' + q;
                    window.open(url,'__blank');
                    return false;
                };
            </script>
        </div> -->
        <!-- 基于bing site搜索: -->
        <div class="nav-linksmall d-none d-lg-inline-flex inputBox">
            <form action="https://bing.com/search" id="searchForm">
                <input type="text" name="q" value="" placeholder="Input then press ENTER" value="" required>
                <div class="search"></div>
            </form>
            <script>
                var searchForm = document.getElementById('searchForm');
                searchForm.onsubmit = function () {
                    var url = this.action;
                    var q = this.children['q'].value;
                    var q = 'site:songtaogui.github.io+' + q
                    // var site = this.children['site'].value;
                    var url = url + '?q=' + q;
                    window.open(url,'__blank');
                    return false;
                };
            </script>
        </div>
        <!-- <div class="nav-icon d-none d-lg-inline-flex"> -->
        <div class="nav-icon">
            <a class=nav-linksmall href="/giants" target="_blank"><span><img class="nav-img"
                src="/assets/img/giant.svg"></span></a>
            <a class=nav-linksmall href="/achievements/" target="_blank"><span><img class="nav-img"
                        src="/assets/img/achievement.svg"></span></a>
            <a class=nav-linksmall href="/feed.xml" target="_blank"><span><img class="nav-img"
                        src="/assets/img/rss.svg"></span></a>
            <a class=nav-linksmall href="/musics" target="_blank"><span><img class="nav-img"
                        src="/assets/img/music.svg"></span></a>
        </div>

    </div>
</nav> 

    <span class="js-widget-page d-none"></span>

    
    <article class=article>
        <div class="article-container pt-3">
             <h1>Julia数据科学系列-Queryverse系列包</h1> 
        </div>
        
        <div class="article-container">
            <!-- 关闭article-style, 不然跟nutshell不兼容 -->
            <!-- <div class="gst-style"> -->
            <div class="layout-main">
                <!-- <div class="article-style"> -->
                
                
                <div class="franklin-content">
<div class="tags"><a href="/tag/" id="tag-icon"><svg width="20" height="20" viewBox="0 0 512 512"><defs><style>.cls-1{fill:#141f38}</style></defs><path class="cls-1" d="M215.8 512a76.1 76.1 0 0 1-54.17-22.44L22.44 350.37a76.59 76.59 0 0 1 0-108.32L242 22.44A76.11 76.11 0 0 1 296.2 0h139.2A76.69 76.69 0 0 1 512 76.6v139.19A76.08 76.08 0 0 1 489.56 270L270 489.56A76.09 76.09 0 0 1 215.8 512zm80.4-486.4a50.69 50.69 0 0 0-36.06 14.94l-219.6 219.6a51 51 0 0 0 0 72.13l139.19 139.19a51 51 0 0 0 72.13 0l219.6-219.61a50.67 50.67 0 0 0 14.94-36.06V76.6a51.06 51.06 0 0 0-51-51zm126.44 102.08A38.32 38.32 0 1 1 461 89.36a38.37 38.37 0 0 1-38.36 38.32zm0-51a12.72 12.72 0 1 0 12.72 12.72 12.73 12.73 0 0 0-12.72-12.76z"/><path class="cls-1" d="M217.56 422.4a44.61 44.61 0 0 1-31.76-13.16l-83-83a45 45 0 0 1 0-63.52L211.49 154a44.91 44.91 0 0 1 63.51 0l83 83a45 45 0 0 1 0 63.52L249.31 409.24a44.59 44.59 0 0 1-31.75 13.16zm-96.7-141.61a19.34 19.34 0 0 0 0 27.32l83 83a19.77 19.77 0 0 0 27.31 0l108.77-108.7a19.34 19.34 0 0 0 0-27.32l-83-83a19.77 19.77 0 0 0-27.31 0l-108.77 108.7z"/><path class="cls-1" d="M294.4 281.6a12.75 12.75 0 0 1-9-3.75l-51.2-51.2a12.8 12.8 0 0 1 18.1-18.1l51.2 51.2a12.8 12.8 0 0 1-9.05 21.85zM256 320a12.75 12.75 0 0 1-9.05-3.75l-51.2-51.2a12.8 12.8 0 0 1 18.1-18.1l51.2 51.2A12.8 12.8 0 0 1 256 320zM217.6 358.4a12.75 12.75 0 0 1-9-3.75l-51.2-51.2a12.8 12.8 0 1 1 18.1-18.1l51.2 51.2a12.8 12.8 0 0 1-9.05 21.85z"/></svg></a><a href="/tag/julia/">julia</a>, <a href="/tag/statistics/">statistics</a>&nbsp;&nbsp;&nbsp;&nbsp;<a id="tag-icon"><svg width="20" height="20" class="icon" viewBox="0 0 1024 1024" version="1.1" p-id="3825" width="64" height="64"><path d="M512 416a96 96 0 1 0 0 192 96 96 0 0 0 0-192z m511.952 102.064c-0.016-0.448-0.064-0.864-0.096-1.296a8.16 8.16 0 0 0-0.08-0.656c0-0.32-0.064-0.624-0.128-0.928-0.032-0.368-0.064-0.736-0.128-1.088-0.032-0.048-0.032-0.096-0.032-0.144a39.488 39.488 0 0 0-10.704-21.536c-32.672-39.616-71.536-74.88-111.04-107.072-85.088-69.392-182.432-127.424-289.856-150.8-62.112-13.504-124.576-14.064-187.008-2.64-56.784 10.384-111.504 32-162.72 58.784-80.176 41.92-153.392 99.696-217.184 164.48-11.808 11.984-23.552 24.224-34.288 37.248-14.288 17.328-14.288 37.872 0 55.216 32.672 39.616 71.52 74.848 111.04 107.056 85.12 69.392 182.448 127.408 289.888 150.784 62.096 13.504 124.608 14.096 187.008 2.656 56.768-10.4 111.488-32 162.736-58.768 80.176-41.936 153.376-99.696 217.184-164.48 11.792-12 23.536-24.224 34.288-37.248 5.712-5.872 9.456-13.44 10.704-21.568l0.032-0.128a12.592 12.592 0 0 0 0.128-1.088c0.064-0.304 0.096-0.624 0.128-0.928l0.08-0.656 0.096-1.28c0.032-0.656 0.048-1.296 0.048-1.952l-0.096-1.968zM512 704c-106.032 0-192-85.952-192-192s85.952-192 192-192 192 85.968 192 192c0 106.048-85.968 192-192 192z" p-id="3826"></path></svg></a><span id="busuanzi_value_page_pv"></span></div>
<div class="franklin-toc"><ol><li><a href="#queryjl">Query.jl</a><ol><li><a href="#简介">简介</a><ol><li><a href="#独立查询操作">独立查询操作</a></li><li><a href="#linq样式查询">LINQ样式查询</a></li><li><a href="#表和缺失值">表和缺失值</a></li></ol></li><li><a href="#独立查询运算符">独立查询运算符</a><ol><li><a href="#宏map">宏@map</a></li><li><a href="#宏filter">宏@filter</a></li><li><a href="#宏groupby">宏@groupby</a></li><li><a href="#宏orderbyorderbydescendingthenbythenbydescending">宏@orderby,@orderby<em>descending,@thenby,@thenby</em>descending</a></li><li><a href="#宏groupjoin">宏@groupjoin</a></li><li><a href="#宏join">宏@join</a></li><li><a href="#宏mapmany">宏@mapmany</a></li><li><a href="#宏takedropunique">宏@take、@drop、@unique</a></li><li><a href="#宏select">宏@select</a></li><li><a href="#宏rename">宏@rename</a></li><li><a href="#宏mutate">宏@mutate</a></li><li><a href="#宏dropnadissallownareplacena">宏@dropna、@dissallowna、@replacena</a></li></ol></li><li><a href="#linq风格的查询命令">LINQ风格的查询命令</a></li><li><a href="#数据输出">数据输出</a></li><li><a href="#实验功能">实验功能</a></li></ol></li><li><a href="#vegalitejl">VegaLite.jl</a><ol><li><a href="#输入数据">输入数据</a></li><li><a href="#vegalitejs中没有的特性">VegaLite.js中没有的特性</a></li><li><a href="#宏vlplot">宏@vlplot</a></li><li><a href="#vl字符串宏"><code>vl</code>字符串宏</a></li><li><a href="#vlspec类型"><code>VLSpec</code>类型</a></li><li><a href="#数据传入">数据传入</a></li><li><a href="#输出">输出</a></li><li><a href="#绘图技巧">绘图技巧</a></li></ol></li><li><a href="#datavoyagerjl">DataVoyager.jl</a></li></ol></div>

<fieldset class="hadmon admon-hack"><legend class="hadmon-legend admon-legend-hack"> Queryverse.jl系列工具</legend>
  <a href="https://www.queryverse.org/">Queryverse</a>是一系列数据处理工具包集合, 目前包含如下工具:</p>
<ul>
<li><p><code>Query.jl</code>: 数据处理</p>
</li>
<li><p><code>VegaLite.jl</code>和<code>Vega.jl</code>: Vega画图语法的julia封装</p>
</li>
<li><p><code>DataVoyager.jl</code>: Vega的Voyager的julia封装</p>
</li>
<li><p><code>ElectronDisplay.jl</code>: 基于<code>Electron</code>的可视化&#40;似乎对我不太有用&#41;</p>
</li>
</ul>
<p>官方提供了一个<code>Queryverse.jl</code>包, 基本包含了常用的Julia数据分析相关包:</p>
<p><fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">module Queryverse

using Reexport

@reexport using DataValues
import IterableTables
@reexport using Query
@reexport using DataTables
@reexport using DataFrames
@reexport using FileIO
@reexport using ExcelFiles
@reexport using StatFiles
@reexport using CSVFiles
@reexport using FeatherFiles
@reexport using ParquetFiles
@reexport using VegaLite
@reexport using DataVoyager

export DV

export @tee

macro tee&#40;ex&#41;
    quote
        x -&gt; begin
            x |&gt; &#36;&#40;esc&#40;ex&#41;&#41;
            return x
        end
    end
end

const DV &#61; DataValues.DataValue

end # module</code></pre>
<p><div class="code-lag">julia</div></fieldset> 
</fieldset>

<h1 id="queryjl"><a href="#queryjl" class="header-anchor">Query.jl</a></h1>
<p>基本上可以对Julia中绝大部分可迭代数据类型&#40;支持<a href="https://github.com/queryverse/TableTraits.jl">TableTraits.jl</a>的数据类型, 涵盖了所有<a href="https://github.com/queryverse/IterableTables.jl">IterableTables.jl</a>中的类型&#41;做处理, 包括<code>filter, project, join, sort, group</code>等, Query受C语言的<code>LINQ</code>和R语言的<code>dplyr</code>启发。</p>

<fieldset class="hadmon admon-tip"><legend class="hadmon-legend admon-legend-tip"> 主要亮点</legend>
</p>
<ul>
<li><p>支持几乎所有<code>C#规范</code>的查询表达式&#40;LINQ&#41;, 还添加了额外的julia特有功能</p>
</li>
<li><p>支持大量数据源: </p>
<p><span class="Sadmon Sadmon-tip">DataFrames.jl</span> <span class="Sadmon Sadmon-tip">Pandas.jl</span> <span class="Sadmon Sadmon-tip">IndexedTables.jl</span> <span class="Sadmon Sadmon-tip">JuliaDB.jl</span> <span class="Sadmon Sadmon-tip">TimeSeries.jl</span> <span class="Sadmon Sadmon-tip">Temporal.jl</span> <span class="Sadmon Sadmon-tip">CSVFiles.jl</span> <span class="Sadmon Sadmon-tip">ExcelFiles.jl</span> <span class="Sadmon Sadmon-tip">FeatherFiles.jl</span> <span class="Sadmon Sadmon-tip">ParquetFiles.jl</span> <span class="Sadmon Sadmon-tip">BedgraphFiles.jl</span> <span class="Sadmon Sadmon-tip">StatFiles.jl</span> <span class="Sadmon Sadmon-tip">DifferentialEquations&#40;任何 DESolution&#41;</span> <span class="Sadmon Sadmon-tip">数组和任何可以迭代的类型</span></p>
</li>
<li><p>处理结果可以具现化为多种数据结构: </p>
<p><span class="Sadmon Sadmon-info">迭代器</span> <span class="Sadmon Sadmon-info">DataFrames.jl</span> <span class="Sadmon Sadmon-info">IndexedTables.jl</span> <span class="Sadmon Sadmon-info">JuliaDB.jl</span> <span class="Sadmon Sadmon-info">TimeSeries.jl</span> <span class="Sadmon Sadmon-info">Temporal.jl</span> <span class="Sadmon Sadmon-info">Pandas.jl</span> <span class="Sadmon Sadmon-info">StatsModels.jl</span> <span class="Sadmon Sadmon-info">CSVFiles.jl</span> <span class="Sadmon Sadmon-info">FeatherFiles.jl</span> <span class="Sadmon Sadmon-info">ExcelFiles.jl</span> <span class="Sadmon Sadmon-info">StatPlots.jl</span> <span class="Sadmon Sadmon-info">VegaLite.jl</span> <span class="Sadmon Sadmon-info">TableView.jl</span> <span class="Sadmon Sadmon-info">DataVoyager.jl</span> <span class="Sadmon Sadmon-info">字典或任何数组</span></p>
</li>
<li><p>一次处理可混合多个源的数据, 比如对<code>DataFrame</code>和<code>CSV文件</code>进行<code>join</code>操作</p>
</li>
<li><p>针对 DataFrames 的查询是完全类型稳定的</p>
</li>
<li><p>提供三种API用来让包开发者使用Query.jl查询:</p>
</li>
<li><p>最简单的API: 只需作者提供一个迭代器</p>
</li>
<li><p>提供查询的完整图表示<code>query graph</code></p>
</li>
<li><p>提供自己的数据结构, 表示一个<code>query graph</code></p>
</li>
</ul>
<p>
</fieldset>

<h2 id="简介"><a href="#简介" class="header-anchor">简介</a></h2>
<p>Query.jl支持两种查询语法:</p>
<ul>
<li><p>独立查询操作&#40;Standalone query operators&#41;</p>
</li>
<li><p>LINQ样式的查询操作</p>
</li>
</ul>
<h3 id="独立查询操作"><a href="#独立查询操作" class="header-anchor">独立查询操作</a></h3>
<p>通过管道运算符组合成复杂的查询:</p>
<fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">using QUery, DataFrames

df &#61; DataFrame&#40;name&#61;&#91;&quot;John&quot;, &quot;Sally&quot;, &quot;Kirk&quot;&#93;,
               age&#61;&#91;23., 42., 59.&#93;,
               children&#61;&#91;3,5,2&#93;&#41;

x &#61; df |&gt;
    @filter&#40;_.age&gt;50&#41; |&gt;
    @map&#40;&#123;_.name, _.children&#125;&#41; |&gt;
    DataFrame

println&#40;x&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset>
<h3 id="linq样式查询"><a href="#linq样式查询" class="header-anchor">LINQ样式查询</a></h3>
<fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">q &#61; @from &lt;range variable&gt; in &lt;source&gt; begin
    &lt;query statements&gt;
end</code></pre>
<p><div class="code-lag">julia</div></fieldset>
<p>多个查询条件用换行符分隔, 上述查询的LINQ样式为:</p>
<fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">x &#61; @from i in df begin
    @where i.age&gt;50
    @select &#123;i.name, i.children&#125;
    @collect DataFrame
    # 注意LINQ中用@collect 定义输出结果的格式
end
println&#40;x&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset>
<p>LINQ查询也可以管道, 使用<code>@query&#40;变量, 查询条件块&#41;</code>:</p>
<fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">x &#61; df |&gt; @query&#40;i, begin
            @where i.age&gt;50
            @select &#123;i.name, i.children&#125;
        end&#41; |&gt; DataFrame
println&#40;x&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset>
<h3 id="表和缺失值"><a href="#表和缺失值" class="header-anchor">表和缺失值</a></h3>
<ul>
<li><p>查询类似表的结构时, 数据被视为<code>NamedTuple</code>, Query中的<code>&#123;&#125;</code>语法用于方便构造<code>NamedTuple</code></p>
</li>
<li><p>缺失值被当作是<code>DataValue</code>类型&#40;<a href="https://github.com/queryverse/DataValues.jl">DataValues.jl</a>&#41;</p>
<ul>
<li><p>所有运算符和比较符都自动处理缺失</p>
</li>
<li><p>如果使用的函数本身不支持缺失值的处理, 可以用<code>.</code>进行运算符提升</p>
</li>
</ul>
</li>
</ul>
<h2 id="独立查询运算符"><a href="#独立查询运算符" class="header-anchor">独立查询运算符</a></h2>
<h3 id="宏map"><a href="#宏map" class="header-anchor">宏@map</a></h3>
<div class="aadmon aadmon-hack"> source |&gt; @map&#40;element_selector&#41;</div>
<p><code>element_selector</code>必须是匿名函数, 接收单个元素</p>
<h3 id="宏filter"><a href="#宏filter" class="header-anchor">宏@filter</a></h3>
<div class="aadmon aadmon-hack"> source |&gt; @filter&#40;filter_condition&#41;</div>
<p><code>filter_condition</code>必须是匿名函数, 返回<span class="cadmon sadmon-error">Boolean类型</span></p>
<h3 id="宏groupby"><a href="#宏groupby" class="header-anchor">宏@groupby</a></h3>
<p>简单形式: <div class="aadmon aadmon-hack"> source |&gt; @groupby&#40;key_selector&#41;</div> <code>key_selector</code>是匿名函数, 为每个输入元素返回一个分组值</p>
<p>变体形式: <div class="aadmon aadmon-hack"> source |&gt; @groupby&#40;source, key<em>selector, element</em>selector&#41;</div> <code>element_selector</code>: 匿名投影函数, 将元素分组之前应用该函数</p>
<p><code>@groupby</code>通常和<code>@map</code>一起使用, 按照分组进行操作, 生成新的数据。</p>
<h3 id="宏orderbyorderbydescendingthenbythenbydescending"><a href="#宏orderbyorderbydescendingthenbythenbydescending" class="header-anchor">宏@orderby,@orderby<em>descending,@thenby,@thenby</em>descending</a></h3>
<p>数据排序操作, 排序必须以<code>@orderby或@orderby_descending</code>开始, 后边可以接多个<code>@thenby,@thenby_descending</code></p>
<p><div class="aadmon aadmon-hack"> source |&gt; @orderby&#40;key_selector&#41;</div> <code>key_selector</code>:匿名函数, 根据返回的值进行排序</p>
<h3 id="宏groupjoin"><a href="#宏groupjoin" class="header-anchor">宏@groupjoin</a></h3>
<p><div class="aadmon aadmon-hack"> outer |&gt; @groupjoin&#40;inner, outer<em>selector, inner</em>selector, result_selector&#41;</div> </p>
<p><code>outer|inner</code>: 任何可查询的源 <code>outer_selector|inner_selector</code>: 匿名函数, 从指定源中提取值 <code>result_selector</code>: 匿名函数, 接受两个参数, 分别来自两个源</p>
<p>例子: <fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">df1 &#61; DataFrame&#40;a&#61;&#91;1,2,3&#93;, b&#61;&#91;1.,2.,3.&#93;&#41;
df2 &#61; DataFrame&#40;c&#61;&#91;2,4,2&#93;, d&#61;&#91;&quot;John&quot;, &quot;Jim&quot;, &quot;Sally&quot;&#93;&#41;

x &#61; df1 |&gt; @groupjoin&#40;df2, _.a, _.c, &#123;t1&#61;_.a, t2&#61;length&#40;__&#41;&#125;&#41; |&gt; DataFrame

println&#40;x&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset></p>
<h3 id="宏join"><a href="#宏join" class="header-anchor">宏@join</a></h3>
<p>命令格式同<code>@groupjoin</code></p>
<fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">df1 &#61; DataFrame&#40;a&#61;&#91;1,2,3&#93;, b&#61;&#91;1.,2.,3.&#93;&#41;
df2 &#61; DataFrame&#40;c&#61;&#91;2,4,2&#93;, d&#61;&#91;&quot;John&quot;, &quot;Jim&quot;,&quot;Sally&quot;&#93;&#41;

x &#61; df1 |&gt; @join&#40;df2, _.a, _.c, &#123;_.a, _.b, __.c, __.d&#125;&#41; |&gt; DataFrame

println&#40;x&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset>

<fieldset class="hadmon admon-error"><legend class="hadmon-legend admon-legend-error"> `@join`和`@groupjoin`的区别是啥?</legend>
  groupjoin等于<span class="cadmon sadmon-error">leftjoin后再group</span>, join则只保留所有有交集的结果, 举个栗子: <fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">df1 &#61; DataFrame&#40;a&#61;&#91;1,2,3&#93;, b&#61;&#91;1.,2.,3.&#93;&#41;
df2 &#61; DataFrame&#40;c&#61;&#91;2,4,2&#93;, d&#61;&#91;&quot;John&quot;, &quot;Jim&quot;,&quot;Sally&quot;&#93;&#41;
x &#61; df1 |&gt; @groupjoin&#40;df2, _.a, _.c, &#123;A&#61;_, B&#61;__&#125;&#41; |&gt; DataFrame # groupjoin
y &#61; df1 |&gt; @join&#40;df2, _.a, _.c, &#123;A&#61;_, B&#61;__&#125;&#41; |&gt; DataFrame # join
julia&gt; x.B # 输出结果跟df1的行数相同, 没有交集的行也输出了
  3-element Vector&#123;Vector&#123;NamedTuple&#123;&#40;:c, :d&#41;, Tuple&#123;Int64, String&#125;&#125;&#125;&#125;:
   &#91;&#93;
   &#91;&#40;c &#61; 2, d &#61; &quot;John&quot;&#41;, &#40;c &#61; 2, d &#61; &quot;Sally&quot;&#41;&#93;
   &#91;&#93;
julia&gt; y.B # 只输出了有交集的行, 且重复的记录逐行输出
  2-element Vector&#123;NamedTuple&#123;&#40;:c, :d&#41;, Tuple&#123;Int64, String&#125;&#125;&#125;:
   &#40;c &#61; 2, d &#61; &quot;John&quot;&#41;
   &#40;c &#61; 2, d &#61; &quot;Sally&quot;&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset> 
</fieldset>

<h3 id="宏mapmany"><a href="#宏mapmany" class="header-anchor">宏@mapmany</a></h3>
<p><div class="aadmon aadmon-hack"> source |&gt; @mapmany&#40;collection<em>selector, result</em>selector&#41;</div> <code>collection_selector</code>: 匿名函数, 接受一个参数, 返回一个<span class="cadmon sadmon-error">集合</span> <code>result_selector</code>: 匿名函数, 接受两个参数</p>
<p>例子: <fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">source &#61; Dict&#40;:a&#61;&gt;&#91;1,2,3&#93;, :b&#61;&gt;&#91;4,5&#93;&#41;

q &#61; source |&gt; @mapmany&#40;_.second, &#123;Key&#61;_.first, Value&#61;__&#125;&#41; |&gt; DataFrame

println&#40;q&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset></p>
<h3 id="宏takedropunique"><a href="#宏takedropunique" class="header-anchor">宏@take、@drop、@unique</a></h3>
<p><div class="aadmon aadmon-hack"> source |&gt; @take&#40;n&#41;, <code>n</code>为整数</div> <div class="aadmon aadmon-hack"> source |&gt; @drop&#40;n&#41;, <code>n</code>为整数</div> <div class="aadmon aadmon-hack"> source |&gt; @unique&#40;&#41;</div> </p>
<h3 id="宏select"><a href="#宏select" class="header-anchor">宏@select</a></h3>
<p>选择指定列</p>
<div class="aadmon aadmon-hack"> source |&gt; @select&#40;selectors...&#41;</div>
<ul>
<li><p><code>source</code> 可以是任何可以查询的来源。</p>
</li>
<li><p><code>selectors...</code>的每个选择器都可以从<code>source</code>中选择元素并将其添加到结果集中，或者从结果集中选择元素并将其删除。</p>
</li>
<li><p>选择器可以通过名称、位置或使用谓词函数来选择或删除元素。</p>
</li>
</ul>
<fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">df &#61; DataFrame&#40;fruit&#61;&#91;&quot;Apple&quot;,&quot;Banana&quot;,&quot;Cherry&quot;&#93;,
               amount&#61;&#91;2,6,1000&#93;,
               price&#61;&#91;1.2,2.0,0.4&#93;,
               isyellow&#61;&#91;false,true,false&#93;&#41;

q1 &#61; df |&gt; @select&#40;2:3, occursin&#40;&quot;ui&quot;&#41;, -:amount&#41; |&gt; DataFrame
# 2:3 &#61;&gt; :amount, :price
# occursin&#40;&quot;ui&quot;&#41; &#61;&gt; :amount, :price, :fruit
# -:amount &#61;&gt; :price, :fruit
println&#40;q1&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset>
<h3 id="宏rename"><a href="#宏rename" class="header-anchor">宏@rename</a></h3>
<div class="aadmon aadmon-hack"> source |&gt; @rename&#40;args...&#41;</div>
<p><code>args...</code>: 顺序执行的重命名操作&#40;<code>:raw &#61;&gt; :new</code>&#41;</p>
<code>q &#61; df |&gt; @rename&#40;:fruit &#61;&gt; :food, :price &#61;&gt; :cost, :food &#61;&gt; :name&#41; |&gt; DataFrame</code>
<h3 id="宏mutate"><a href="#宏mutate" class="header-anchor">宏@mutate</a></h3>
<div class="aadmon aadmon-hack"> source |&gt; @mutate&#40;args...&#41;</div>
<p><code>args...</code>: 指定<span class="cadmon sadmon-error">元素名</span>和<span class="cadmon sadmon-error">值转换公式</span>, 顺序执行</p>
<fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">df &#61; DataFrame&#40;fruit&#61;&#91;&quot;Apple&quot;,&quot;Banana&quot;,&quot;Cherry&quot;&#93;,
               amount&#61;&#91;2,6,1000&#93;,
               price&#61;&#91;1.2,2.0,0.4&#93;,
               isyellow&#61;&#91;false,true,false&#93;&#41;

q &#61; df |&gt; @mutate&#40;price &#61; 2 * _.price &#43; _.amount, isyellow &#61; _.fruit &#61;&#61; &quot;Apple&quot;&#41; |&gt; DataFrame
println&#40;q&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset>
<h3 id="宏dropnadissallownareplacena"><a href="#宏dropnadissallownareplacena" class="header-anchor">宏@dropna、@dissallowna、@replacena</a></h3>

<fieldset class="hadmon admon-info"><legend class="hadmon-legend admon-legend-info"> `@dropna`: 去除指定列包含缺失的行</legend>
 <div class="aadmon aadmon-hack"> source |&gt; @dropna&#40;columns...&#41;</div></p>
<p>如果不带参数调用<code>@dropna</code>, 将删除任何一列包含<code>NA&#40;missing&#41;</code>的行。 
</fieldset>


<fieldset class="hadmon admon-info"><legend class="hadmon-legend admon-legend-info"> `@dissallowna`: 将指定列的数据转换成不允许有缺失的类型</legend>
 <div class="aadmon aadmon-hack"> source |&gt; @dissallowna&#40;columns...&#41;</div> 
</fieldset>


<fieldset class="hadmon admon-info"><legend class="hadmon-legend admon-legend-info"> `@replacena`: 替换指定列的缺失值为指定值</legend>
  <strong>简单版:</strong></p>
<p><div class="aadmon aadmon-hack"> source |&gt; @replacena&#40;replacement_value&#41;</div> 其中<code>replacement_value</code>是值, 简单版只适用于所有列都批量替换成同一个值的情形</p>
<p><strong>完整版:</strong></p>
<p>当不同的列需要不同的替换逻辑时, 要用完整版: <div class="aadmon aadmon-hack"> source |&gt; @replacena&#40;replacement_specifier...&#41;</div></p>
<p><code>replacement_specifier...</code>: 是<code>column_name &#61;&gt; replacement_value</code>的键值对 
</fieldset>

<h2 id="linq风格的查询命令"><a href="#linq风格的查询命令" class="header-anchor">LINQ风格的查询命令</a></h2>
<fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">using Query, DataFrames

# Sorting:
# @orderby &lt;attribute&gt;&#91;, &lt;attribute&gt;&#93;
df &#61; DataFrame&#40;a&#61;&#91;2,1,1,2,1,3&#93;,b&#61;&#91;2,2,1,1,3,2&#93;&#41;
x &#61; @from i in df begin
    @orderby descending&#40;i.a&#41;, i.b
    @select i
    @collect DataFrame
end

# Filtering
# @where &lt;condition&gt;
df &#61; DataFrame&#40;name&#61;&#91;&quot;John&quot;, &quot;Sally&quot;, &quot;Kirk&quot;&#93;, age&#61;&#91;23., 42., 59.&#93;, children&#61;&#91;3,5,2&#93;&#41;
x &#61; @from i in df begin
    @where i.age &gt; 30. &amp;&amp; i.children &gt; 2
    @select i
    @collect DataFrame
end

# Projecting
# @select &lt;condition&gt;
data &#61; &#91;1,2,3&#93;
x &#61; @from i in data begin
    @select i^2
    @collect
end
# query中应用&#96;&#123;&#125;&#96;可以将元素转换成命名元组
df &#61; DataFrame&#40;name&#61;&#91;&quot;John&quot;, &quot;Sally&quot;, &quot;Kirk&quot;&#93;, age&#61;&#91;23., 42., 59.&#93;, children&#61;&#91;3,5,2&#93;&#41;
x &#61; @from i in df begin
    @select &#123;i.name, Age&#61;i.age&#125; # 不定义名称时, 自动推断name; 显式声明名称Age;
    @collect DataFrame
end

# Flattening
# 使用多个@from实现:
# @from &lt;range_var&gt; in &lt;selector&gt;
source &#61; Dict&#40;:a&#61;&gt;&#91;1,2,3&#93;, :b&#61;&gt;&#91;4,5&#93;&#41;
q &#61; @from i in source begin
    @from j in i.second
    @select &#123;Key&#61;i.first,Value&#61;j&#125;
    @collect DataFrame
end

# Joining
# @join &lt;range variable&gt; in &lt;source&gt; on &lt;left key&gt; equals &lt;right key&gt;
df1 &#61; DataFrame&#40;a&#61;&#91;1,2,3&#93;, b&#61;&#91;1.,2.,3.&#93;&#41;
df2 &#61; DataFrame&#40;c&#61;&#91;2,4,2&#93;, d&#61;&#91;&quot;John&quot;, &quot;Jim&quot;,&quot;Sally&quot;&#93;&#41;

x &#61; @from i in df1 begin
    @join j in df2 on i.a equals j.c
    @select &#123;i.a,i.b,j.c,j.d&#125;
    @collect DataFrame
end

# Group join
# @join &lt;range variable&gt; in &lt;source&gt; on &lt;left key&gt; equals &lt;right key&gt; into &lt;group variable&gt;
df1 &#61; DataFrame&#40;a&#61;&#91;1,2,3&#93;, b&#61;&#91;1.,2.,3.&#93;&#41;
df2 &#61; DataFrame&#40;c&#61;&#91;2,4,2&#93;, d&#61;&#91;&quot;John&quot;, &quot;Jim&quot;,&quot;Sally&quot;&#93;&#41;

x &#61; @from i in df1 begin
    @join j in df2 on i.a equals j.c into k
    @select &#123;t1&#61;i.a,t2&#61;length&#40;k&#41;&#125;
    @collect DataFrame
end

# Left outer join
# @left_outer_join &lt;range variable&gt; in &lt;source&gt; on &lt;left key&gt; equals &lt;right key&gt;
source_df1 &#61; DataFrame&#40;a&#61;&#91;1,2,3&#93;, b&#61;&#91;1.,2.,3.&#93;&#41;
source_df2 &#61; DataFrame&#40;c&#61;&#91;2,4,2&#93;, d&#61;&#91;&quot;John&quot;, &quot;Jim&quot;,&quot;Sally&quot;&#93;&#41;

q &#61; @from i in source_df1 begin
    @left_outer_join j in source_df2 on i.a equals j.c
    @select &#123;i.a,i.b,j.c,j.d&#125;
    @collect DataFrame
end

# Grouping
# @group &lt;element selector&gt; by &lt;key selector&gt; &#91;into &lt;range variable&gt;&#93;
df &#61; DataFrame&#40;name&#61;&#91;&quot;John&quot;, &quot;Sally&quot;, &quot;Kirk&quot;&#93;, age&#61;&#91;23., 42., 59.&#93;, children&#61;&#91;3,2,2&#93;&#41;
x &#61; @from i in df begin
    @group i.name by i.children
    @collect
end
# with into:
df &#61; DataFrame&#40;name&#61;&#91;&quot;John&quot;, &quot;Sally&quot;, &quot;Kirk&quot;&#93;, age&#61;&#91;23., 42., 59.&#93;, children&#61;&#91;3,2,2&#93;&#41;
x &#61; @from i in df begin
    @group i by i.children into g
    @select &#123;Key&#61;key&#40;g&#41;,Count&#61;length&#40;g&#41;&#125;
    @collect DataFrame
end

# Split-Apply-Combine a.k.a dplyr
# @select new_var &#61; agg_fun&#40;g.var&#41;
# agg_fun是聚合函数, 如mean, g是分组, var是要汇总的列
df &#61; DataFrame&#40;name&#61;repeat&#40;&#91;&quot;John&quot;, &quot;Sally&quot;, &quot;Kirk&quot;&#93;,
               inner&#61;&#91;1&#93;,outer&#61;&#91;2&#93;&#41;, 
               age&#61;vcat&#40;&#91;10., 20., 30.&#93;,&#91;10., 20., 30.&#93;.&#43;3&#41;, 
               children&#61;repeat&#40;&#91;3,2,2&#93;,inner&#61;&#91;1&#93;,outer&#61;&#91;2&#93;&#41;,
               state&#61;&#91;:a,:a,:a,:b,:b,:b&#93;&#41;

x &#61; @from i in df begin
    @group i by i.state into g
    @select &#123;group&#61;key&#40;g&#41;,mage&#61;mean&#40;g.age&#41;, oldest&#61;maximum&#40;g.age&#41;, youngest&#61;minimum&#40;g.age&#41;&#125;
    @collect DataFrame
end

# Range variables
# @let &lt;range variable&gt; &#61; &lt;value selector&gt;
df &#61; DataFrame&#40;name&#61;&#91;&quot;John&quot;, &quot;Sally&quot;, &quot;Kirk&quot;&#93;,
               age&#61;&#91;23., 42., 59.&#93;, 
               children&#61;&#91;3,2,2&#93;&#41;

x &#61; @from i in df begin
    @let count &#61; length&#40;i.name&#41;
    @let kids_per_year &#61; i.children / i.age
    @where count &gt; 4
    @select &#123;Name&#61;i.name, Count&#61;count, KidsPerYear&#61;kids_per_year&#125;
    @collect DataFrame
end</code></pre>
<p><div class="code-lag">julia</div></fieldset>
<h2 id="数据输出"><a href="#数据输出" class="header-anchor">数据输出</a></h2>
<div class="aadmon aadmon-info"> @collect &lt;TableType&gt;</div>
<ul>
<li><p><code>TableType</code>: 可以是<code>DataFrame</code>,<code>DataTable</code>或者<code>TypedTable</code></p>
</li>
<li><p><code>@collect</code>不带参数则输出<code>array</code>类型</p>
</li>
<li><p><code>TableType</code>可以是<code>dict</code>, 但只在输出结果是<code>Pair</code>的时候有效</p>
</li>
<li><p><code>TableType</code>还可以是<code>TimeArray</code>,<code>TS</code>&#40;<code>Temporal.TS</code>&#41;,<code>IndexedTable</code>, 具体略。</p>
</li>
</ul>
<h2 id="实验功能"><a href="#实验功能" class="header-anchor">实验功能</a></h2>
<p>可能会在未来版本中改动或消失的功能:</p>
<ul>
<li><p>Source可以作为独立查询的第一个参数: <code>source |&gt; @map&#40;_&#41;</code>和<code>@map&#40;source,_&#41;</code>等价</p>
</li>
<li><p>在独立查询命令中, <code>_</code>表示第一个参数, <code>__</code>表示第二个参数, 如果同时使用了<code>_</code>和<code>__</code>, query会自动创建带有两个参数的匿名函数:</p>
</li>
</ul>
<div class="indent-block" style="margin-left: 2em !important"> <fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">df_parents &#61; DataFrame&#40;Name&#61;&#91;&quot;John&quot;, &quot;Sally&quot;&#93;&#41;
df_children &#61; DataFrame&#40;Name&#61;&#91;&quot;Bill&quot;, &quot;Joe&quot;, &quot;Mary&quot;&#93;, Parent&#61;&#91;&quot;John&quot;, &quot;John&quot;, &quot;Sally&quot;&#93;&#41;

df_parents |&gt; @join&#40;df_children, _.Name, _.Parent, &#123;Parent&#61;_.Name, Child&#61;__.Name&#125;&#41; |&gt; DataFrame</code></pre>
<p><div class="code-lag">julia</div></fieldset> </div>
<ul>
<li><p><code>@unique</code>的自定义选择器: <code>source |&gt; @unique&#40;abs&#40;_&#41;&#41; |&gt; collect</code></p>
</li>
</ul>
<h1 id="vegalitejl"><a href="#vegalitejl" class="header-anchor">VegaLite.jl</a></h1>

<fieldset class="hadmon admon-note"><legend class="hadmon-legend admon-legend-note"> VegaLite</legend>
  VegaLite是基于json的数据可视化语法, 在<a href="/notebooks/VegaLite">这里</a>有详细的介绍。<code>VegaLite.jl</code>是对VegaLite的封装, 旨在更方便地在julia中进行基于VegaLite的画图, 这里只介绍julia中的一些用法, VegaLite的语法不再赘述。 
</fieldset>

<h2 id="输入数据"><a href="#输入数据" class="header-anchor">输入数据</a></h2>
<ul>
<li><p>DataFrame</p>
</li>
<li><p>JuliaDB</p>
</li>
<li><p>CSVFiles</p>
</li>
<li><p>VegaDatasets</p>
</li>
</ul>
<h2 id="vegalitejs中没有的特性"><a href="#vegalitejs中没有的特性" class="header-anchor">VegaLite.js中没有的特性</a></h2>
<ul>
<li><p>绘图结果在julia中保存为<code>VLSpec</code>类型的对象</p>
</li>
<li><p>用<code>@vlplot</code>宏或者<code>vl</code>字符串宏创建<code>VLSpec</code>对象</p>
</li>
<li><p>重载了<code>load</code>函数, 加载VagaLite的json文件为<code>VLSpec</code></p>
</li>
<li><p>重载了<code>save</code>函数, 用于输出<code>VLSpec</code>为图像:</p>
</li>
</ul>
<div class="indent-block" style="margin-left: 2em !important"> <fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">dataset&#40;&quot;cars&quot;&#41; |&gt; 
    @vlplot&#40;:bar, x&#61;&quot;count&#40;&#41;&quot;, y&#61;:Origin&#41; |&gt;
    save&#40;&quot;myplot.pdf&quot;&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset> </div>
<h2 id="宏vlplot"><a href="#宏vlplot" class="header-anchor">宏@vlplot</a></h2>
<p>基本与VegaLite的json语法一致, 但是提供了一些简便的写法:</p>

<table id="lov"><tr>
<td id="lov" height=90% style="width:50%">
 <fieldset class="code code-json"><legend class="code-legend code-legend-json">json</legend></p>
<pre><code class="language-json">// VegaLite json语法
&#123;
  &quot;data&quot;: &#123;
    &quot;values&quot;: &#91;
      &#123;&quot;a&quot;: &quot;A&quot;,&quot;b&quot;: 28&#125;, &#123;&quot;a&quot;: &quot;B&quot;,&quot;b&quot;: 55&#125;, &#123;&quot;a&quot;: &quot;C&quot;,&quot;b&quot;: 43&#125;,
      &#123;&quot;a&quot;: &quot;D&quot;,&quot;b&quot;: 91&#125;, &#123;&quot;a&quot;: &quot;E&quot;,&quot;b&quot;: 81&#125;, &#123;&quot;a&quot;: &quot;F&quot;,&quot;b&quot;: 53&#125;,
      &#123;&quot;a&quot;: &quot;G&quot;,&quot;b&quot;: 19&#125;, &#123;&quot;a&quot;: &quot;H&quot;,&quot;b&quot;: 87&#125;, &#123;&quot;a&quot;: &quot;I&quot;,&quot;b&quot;: 52&#125;
    &#93;
  &#125;,
  &quot;mark&quot;: &quot;bar&quot;,
  &quot;encoding&quot;: &#123;
    &quot;x&quot;: &#123;&quot;field&quot;: &quot;a&quot;, &quot;type&quot;: &quot;ordinal&quot;&#125;,
    &quot;y&quot;: &#123;&quot;field&quot;: &quot;b&quot;, &quot;type&quot;: &quot;quantitative&quot;&#125;
  &#125;
&#125;</code></pre>
<p><div class="code-lag">json</div></fieldset> 
</td>
<td id="lov" width="50%" height=90% align="left">
 <fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia"># @vlplot语法
@vlplot&#40;
    data&#61;&#123;
        values&#61;&#91;
            &#123;a&#61;&quot;A&quot;,b&#61;28&#125;,&#123;a&#61;&quot;B&quot;,b&#61;55&#125;,&#123;a&#61;&quot;C&quot;,b&#61;43&#125;,
            &#123;a&#61;&quot;D&quot;,b&#61;91&#125;,&#123;a&#61;&quot;E&quot;,b&#61;81&#125;,&#123;a&#61;&quot;F&quot;,b&#61;53&#125;,
            &#123;a&#61;&quot;G&quot;,b&#61;19&#125;,&#123;a&#61;&quot;H&quot;,b&#61;87&#125;,&#123;a&#61;&quot;I&quot;,b&#61;52&#125;
        &#93;
    &#125;,
    mark&#61;&quot;bar&quot;,
    encoding&#61;&#123;
        x&#61;&#123;field&#61;&quot;a&quot;, type&#61;&quot;ordinal&quot;&#125;,
        y&#61;&#123;field&#61;&quot;b&quot;, type&#61;&quot;quantitative&quot;&#125;
    &#125;
&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset> 
</td>
</tr></table>

<ul>
<li><p>移除了最外侧的<code>&#123;&#125;</code></p>
</li>
<li><p>冒号分隔改为用<code>&#61;</code>键值对分隔;</p>
</li>
<li><p>键不用引号, 左侧直接用字母, 右侧可以用<code>symbol</code>: <code>mark&#61;:bar</code></p>
</li>
<li><p>JSON中的<code>null</code><span class="cadmon sadmon-error">应该替换为</span>Julia中的<code>nothing</code></p>
</li>
<li><p>提供与python的<code>Altair</code>中类似的编码速记用法</p>
</li>
</ul>

<fieldset class="hadmon admon-note"><legend class="hadmon-legend admon-legend-note"> 编码速记字符串语法</legend>
</p>
<ul>
<li><p><code>field</code>和<code>type</code>的映射可以直接写成<code>field:type</code>:</p>
</li>
</ul>
<div class="indent-block" style="margin-left: 2em !important"> <fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">x&#61;&#123;field&#61;:a, type&#61;:ordinal&#125;
# 可以写成
x&#61;&#123;&quot;a:o&quot;&#125;</code></pre>
<p><div class="code-lag">julia</div></fieldset> 注意: 字符串简写必须作为<code>&#123;&#125;</code>中的第一个位置参数出现 </div>
<ul>
<li><p><code>timeUnit</code>和<code>aggregate</code>中的聚合函数, 也可以用简写语法:</p>
</li>
</ul>
<div class="indent-block" style="margin-left: 2em !important"> <fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia"># aggregate:
x&#61;&#123;field&#61;:foo, aggregate&#61;:mean, type&#61;:quantitative&#125;
# 可以简写成:
x&#61;&#123;&quot;mean&#40;foo&#41;&quot;&#125; # 默认aggregate的结果就是quantitative

# timeUnit:
x&#61;&#123;field&#61;:foo, timeUnit&#61;:year, type&#61;:quantitative&#125;
# 可以简写成:
x&#61;&#123;&quot;year&#40;foo&#41;:t&quot;&#125;</code></pre>
<p><div class="code-lag">julia</div></fieldset> </div>
<ul>
<li><p>如果字符串简写后不加其他属性,则可以省略<code>&#123;&#125;</code>: <code>x&#61;&quot;foo:q&quot;</code>等同于<code>x&#61;&#123;field&#61;:foo, type&#61;:quantitative&#125;</code>, 如果不想指定类型, 还可以直接用<code>Symbol</code>: <code>x&#61;:foo</code></p>
</li>
<li><p><code>encoding</code>的简写</p>
<ul>
<li><p><code>encoding</code>可以写成<code>enc</code></p>
</li>
<li><p>更简单的, 可以把<code>encoding</code>的内容直接写在顶层: <code>@vlplot&#40;mark&#61;:point, x&#61;&quot;a:o&quot;, y&#61;:b&#41;</code></p>
</li>
</ul>
</li>
<li><p><code>mark</code>的简写</p>
<ul>
<li><p>用第一个位置参数表示<code>mark</code>: <code>@vlplot&#40;:point, x&#61;&quot;a:o&quot;, y&#61;:b&#41;</code></p>
</li>
<li><p>用<code>&#123;&#125;</code>指定更多标记属性, 将类型作为<code>&#123;&#125;</code>内第一个位置参数<code>mark&#61;&#123;:point, color&#61;:red&#125;</code></p>
</li>
</ul>
</li>
<li><p><code>x</code>和<code>y</code>的简写</p>
<ul>
<li><p>可以作为<code>@vlplot</code>的第二个和第三个位置参数传递: <code>@vlplot&#40;:point, :colA, :colB&#41;</code></p>
</li>
</ul>
</li>
</ul>
<p>
</fieldset>

<h2 id="vl字符串宏"><a href="#vl字符串宏" class="header-anchor"><code>vl</code>字符串宏</a></h2>
<div class="aadmon aadmon-hack"> <code>spec &#61; vl&quot;&quot;&quot;&lt;raw Vega-Lite json&gt;&quot;&quot;&quot;</code></div>
<ul>
<li><p><code>Vega.printrepr</code>可以将<code>JSON</code>转换成<code>@vlplot</code>格式的作图语法输出</p>
</li>
</ul>
<h2 id="vlspec类型"><a href="#vlspec类型" class="header-anchor"><code>VLSpec</code>类型</a></h2>
<p>VegaLite的属性可以作为<code>VLSpec</code>的对应属性进行访问: <fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">spec &#61; data&#40;&quot;cars&quot;&#41; |&gt; @vlplot&#40;:point, x&#61;:Acceleration, y&#61;:Cylinders&#41;
spec.mark
spec.encoding.x.field
# 使用Setfiled.jl/Accessors.jl的@set更改属性:
using Setfield  # imports &#96;@set&#96; etc.
spec2 &#61; @set spec.mark &#61; :line
spec3 &#61; @set spec2.encoding.y.field &#61; &quot;Miles_per_Gallon&quot;</code></pre>
<p><div class="code-lag">julia</div></fieldset></p>
<h2 id="数据传入"><a href="#数据传入" class="header-anchor">数据传入</a></h2>
<ul>
<li><p>管道: <code>df |&gt; @filter&#40;_.a&gt;30&#41; |&gt; @vlplot&#40;:point, x&#61;:a, y&#61;:b&#41;</code></p>
</li>
<li><p><code>data</code>关键字: <code>@vlplot&#40;:point, data&#61;df, x&#61;:a, y&#61;:b&#41;</code></p>
</li>
<li><p>直接传递数据向量: <code>@vlplot&#40;:line, x&#61;1:10, y&#61;&#123;randn&#40;10&#41;, title&#61;&quot;XXX&quot;&#125;&#41;</code></p>
</li>
<li><p>引用外部数据<code>uri</code>&#40;基于<a href="https://github.com/JuliaWeb/URIParser.jl">URIParser.jl</a>&#41;和<code>Path</code>&#40;基于<a href="https://github.com/rofinn/FilePaths.jl">FilePaths.jl</a>&#41;:</p>
</li>
</ul>
<div class="indent-block" style="margin-left: 2em !important"> <fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">using FilePaths, URIParsing

p&quot;xxx/yyy/zzz.csv&quot; |&gt; @vlplot&#40;:point, :a, :b&#41;
URI&#40;&quot;https://www.xxx.com/yyy.csv&quot;&#41; |&gt; @vlplot&#40;:point, :a, :b&#41;

@vlplot&#40;:point, data&#61;p&quot;subfolder/file.csv&quot;, x&#61;:a, y&#61;:b&#41;
@vlplot&#40;:point, data&#61;URI&#40;&quot;https://www.foo.com/bar.json&quot;&#41;, x&#61;:a, y&#61;:b&#41;

@vlplot&#40;
    :point,
    data&#61;&#123;
        url&#61;p&quot;subfolder/foo.txt&quot;,
        format&#61;&#123;type&#61;:csv&#125;
    &#125;,
    x&#61;:a,
    y&#61;:b
&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset> </div>
<h2 id="输出"><a href="#输出" class="header-anchor">输出</a></h2>
<fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia"># 根据后缀名判断输出文件格式
p |&gt; save&#40;&quot;figure.png&quot;&#41;
p |&gt; save&#40;&quot;figure.svg&quot;&#41;
p |&gt; save&#40;&quot;figure.pdf&quot;&#41;
p |&gt; save&#40;&quot;figure.eps&quot;&#41;
p |&gt; save&#40;&quot;figure.vegalite&quot;&#41;

save&#40;&quot;figure.png&quot;, p&#41;
save&#40;&quot;figure.svg&quot;, p&#41;
save&#40;&quot;figure.pdf&quot;, p&#41;
save&#40;&quot;figure.eps&quot;, p&#41;
save&#40;&quot;figure.html&quot;, p&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset>
<h2 id="绘图技巧"><a href="#绘图技巧" class="header-anchor">绘图技巧</a></h2>
<ul>
<li><p>只将必要的列传递给<code>@vlplot</code></p>
</li>
</ul>
<h1 id="datavoyagerjl"><a href="#datavoyagerjl" class="header-anchor">DataVoyager.jl</a></h1>
<p>将Julia的Data直接传递给<a href="https://github.com/vega/voyager">Voyager</a>进行交互式数据探索:</p>
<fieldset class="code code-julia"><legend class="code-legend code-legend-julia">julia</legend></p>
<pre><code class="language-julia">using DataFrames, DataVoyager

data &#61; DataFrame&#40;a&#61;rand&#40;100&#41;, b&#61;randn&#40;100&#41;&#41;

v1 &#61; data |&gt; Voyager&#40;&#41;
v2 &#61; Voyager&#40;data&#41;

# 用 &#96;&#91;&#93;&#96; 提取作图结果:
plot1 &#61; v1&#91;&#93; # plot1 is a VLSpec
# 保存和重载:
v&#91;&#93; |&gt; save&#40;&quot;figure1.vegalite&quot;&#41;
dataset&#40;&quot;cars&quot;&#41; |&gt; load&#40;&quot;figure1.vegalite&quot;&#41;</code></pre>
<p><div class="code-lag">julia</div></fieldset>


</div>
<!-- article style -->


 <hr>

<script src="https://utteranc.es/client.js"
    repo="songtaogui/blog_comments"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>


<hr> 

<div class="container">
    
    <footer class="site-footer">
        <p class="powered-by">
          <script type="text/javascript" src="//rf.revolvermaps.com/0/0/4.js?i=5jnkqismgmy&amp;m=5&amp;h=128&amp;c=baff00&amp;r=0" async="async"></script><br>
            Total visits: <span id="busuanzi_value_site_pv"></span>.<br>
            Built with <a href="https://franklinjl.org" target="_blank" rel="noopener">Franklin.jl</a> and <a
                href="https://julialang.org" target="_blank" rel="noopener">Julia</a>.<br>
            Texts are licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.<br>
            Codes are licensed under the <a href="https://mit-license.org/">MIT License</a>.<br>
            <strong>&copy; Songtao Gui</strong>. Last modified: April 30, 2023.
          </p>
    </footer>
    
</div>
</div>


</div>
<!--article container -->
</article>


<!-- CONTENT ENDS HERE -->

 <script src="/libs/highlight/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>
 

<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js
    integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js
    integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js
    integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script>
<script src="/libs/academic/academic.min.js"></script>
<script src="/libs/pure/ui.js"></script>

</body>


 <a class="js-back-to-top back-to-top-button" href="#">
    <img src="/assets/img/up.svg" style="width: 100px;">
</a>
<!-- <button class="js-back-to-top back-to-top-button" title="BackToTop">︽</button> -->
<script src="https://cdn.staticfile.org/jquery/2.2.4/jquery.min.js"></script>
<script>
    $(function () {
        var $win = $(window);
        var $backToTop = $('.js-back-to-top');
        // 当用户滚动到离顶部100像素时，展示回到顶部按钮
        $win.scroll(function () {
            if ($win.scrollTop() > 100) {
                $backToTop.show();
            } else {
                $backToTop.hide();
            }
        });
        // 当用户点击按钮时，通过动画效果返回头部
        $backToTop.click(function () {
            $('html, body').animate({
                scrollTop: 0
            }, 200);
        });
    });
</script>
<style>
    /* back to top button */
    .back-to-top-button {
        display: none;
        position: fixed;
        width: 50px;
        bottom: 3%;
        right: 3%;
        z-index: 99;
        font-size: 15px;
        border: 0px solid #696969;
        background-color: #fff;
        color: #222222;
        outline: none;
        cursor: pointer;
        padding: 7px;
        border-radius: 40px;
    }

    .back-to-top-button:hover {
        background-color: #c0dbf5;
        color: #fff;
    }
</style> 


<!-- PJAX配置: 先不搞了! -->
<!--   
  <script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script>
  
  <script>
    var pjax = new Pjax({
      elements: "a",
      selectors: [
        "title",
        "meta[name=description]",
        ".the-header",
        ".the-content",
        ".the-sidebar",
      ]
    })
  </script> -->

</html>



