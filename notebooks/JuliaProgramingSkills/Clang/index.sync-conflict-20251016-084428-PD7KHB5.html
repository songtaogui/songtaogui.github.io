
<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="sKCEBeALSs13uui0cWMviq9hlm0rPByKQKNHnOdq-d0" />
    <meta name="baidu-site-verification" content="code-MBwKQgVpns" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Songtao Gui">

    
    <meta name="description" content="Clang.jl: wrapper for libclang
">
    

    
    
    <meta name="keywords" content="Clang">
    <title>Clang</title>
    

    <link rel="icon" href="/assets/favicon.svg">

    <!-- Dark mode -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
    <script>
        function addDarkmodeWidget()
        {
            const options = {
                top: 'unset',
                bottom: 'unset', /* default: '32px' */
                right: 'unset', /* default: '32px' */
                left: '50px', /* default: 'unset' */
                time: '.0s', /* default: '0.3s' */
                mixColor: '#fff', /* default: '#fff' */
                backgroundColor: '#fff', /* default: '#fff' */
                buttonColorDark: '#100f2c', /* default: '#100f2c' */
                buttonColorLight: '#fff', /* default: '#fff' */
                saveInCookies: true, /* default: true, */
                label: 'ğŸŒ“', /* default: '' */
                autoMatchOsTheme: true /* default: true */
            };
            new Darkmode(options).showWidget();
        };
        window.addEventListener('DOMContentLoaded', addDarkmodeWidget);
    </script> -->
    
<link rel=preconnect href="https://fonts.gstatic.com" crossorigin=anonymous>
<link rel=stylesheet href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    crossorigin=anonymous>
<link rel=stylesheet href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css"
    crossorigin=anonymous>
<link rel=stylesheet href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" crossorigin=anonymous>
<link rel=stylesheet
    href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap"
    crossorigin=anonymous>
<!-- locally served -->
<link rel="stylesheet" href="/css/pure.css">
<link rel=stylesheet href="/libs/academic/academic.min.css">
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/extra.css">
<link rel=stylesheet href="/css/codeset.css">
<link rel=stylesheet href="/css/admonition.css">
<link rel=stylesheet href="/css/cv.css">
<link rel=stylesheet href="/css/search-box.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
<link rel=stylesheet href="/css/vega.css">
<!-- <link rel=stylesheet href="/css/font-awesome.css"> -->

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- nutshell + highlight + katex + plotly -->


    <link rel=stylesheet href="/libs/highlight/styles/atom-one-light.min.css"> 




 
<!-- end for isnotdef revealslide -->


<!-- end for isdef revealslide -->
    <!-- Vega -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.0/dist/svg.min.js"></script>
    <style media="screen">
        /* Add space between Vega-Embed links  */
        .vega-actions a {
            margin-right: 5px;
        }
    </style>
    <!-- end Vega -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js"
        integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin=anonymous async></script>
</head>

<body id=top data-spy="scroll" data-offset="70" data-target=#navbar-main>
    <!-- Swiftype -->
    <script type="text/javascript">
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
        (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
        
        _st('install','J57vdqtTa8oYL-ikpKNG','2.0.0');
    </script>
    
     <!-- control the navbar of my blog -->
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main>
    <div class=container>
        <!-- Main name -->
        <div class="d-none d-lg-inline-flex">
            <a class=navbar-brand href="/"><span class="cv-contact">
                <img class="cv-img" src="/assets/personal/namesign.svg">
            </span></a>
        </div>
        <!-- Button for narrow mode -->
        <button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar
            aria-expanded=false aria-label="Toggle navigation">
            <span><i class="fas fa-bars"></i></span>
        </button>
        <!-- Main name for mobile mode -->
        <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
            <a class=navbar-brand href="/"><span class="cv-contact">
                <img class="cv-img" src="/assets/personal/namesign.svg">
            </span></a>
        </div>
        <!-- Menu items -->
        <div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content>
            <ul class="navbar-nav d-md-inline-flex">
                <li class=nav-item><a class=nav-link href="/posts/"><span>Posts</span></a></li>
                <li class=nav-item><a class=nav-link href="/courses/"><span>Courses</span></a></li>
                <li class=nav-item><a class=nav-link href="/notebooks/"><span>Notebooks</span></a></li>
                <li class=nav-item><a class=nav-link href="/cv/"><span>CurriculumVitae</span></a></li>
                <li class=nav-item><a class=nav-link href="/tag/"><span>Tags</span></a></li>
            </ul>
        </div>
        <!-- <div class="nav-linksmall d-none d-lg-inline-flex inputBox">
                <input type="text" class="st-default-search-input" placeholder="Input then press ENTER" value="" required>
                <div class="search"></div>
            <script>
                var searchForm = document.getElementById('searchForm');
                searchForm.onsubmit = function () {
                    var url = this.action;
                    var q = this.children['q'].value;
                    var q = 'site:songtaogui.github.io+' + q
                    // var site = this.children['site'].value;
                    var url = url + '?q=' + q;
                    window.open(url,'__blank');
                    return false;
                };
            </script>
        </div> -->
        <!-- åŸºäºbing siteæœç´¢: -->
        <div class="nav-linksmall d-none d-lg-inline-flex inputBox">
            <form action="https://bing.com/search" id="searchForm">
                <input type="text" name="q" value="" placeholder="Input then press ENTER" value="" required>
                <div class="search"></div>
            </form>
            <script>
                var searchForm = document.getElementById('searchForm');
                searchForm.onsubmit = function () {
                    var url = this.action;
                    var q = this.children['q'].value;
                    var q = 'site:songtaogui.github.io+' + q
                    // var site = this.children['site'].value;
                    var url = url + '?q=' + q;
                    window.open(url,'__blank');
                    return false;
                };
            </script>
        </div>
        <!-- <div class="nav-icon d-none d-lg-inline-flex"> -->
        <div class="nav-icon">
            <a class=nav-linksmall href="/giants" target="_blank"><span><img class="nav-img"
                src="/assets/img/giant.svg"></span></a>
            <a class=nav-linksmall href="/achievements/" target="_blank"><span><img class="nav-img"
                        src="/assets/img/achievement.svg"></span></a>
            <a class=nav-linksmall href="/feed.xml" target="_blank"><span><img class="nav-img"
                        src="/assets/img/rss.svg"></span></a>
            <a class=nav-linksmall href="/musics" target="_blank"><span><img class="nav-img"
                        src="/assets/img/music.svg"></span></a>
        </div>

    </div>
</nav> 

    <span class="js-widget-page d-none"></span>

    
    <article class=article>
        <div class="article-container pt-3">
             <h1>Clang</h1> 
        </div>
        
        <div class="article-container">
            <!-- å…³é—­article-style, ä¸ç„¶è·Ÿnutshellä¸å…¼å®¹ -->
            <!-- <div class="gst-style"> -->
            <div class="layout-main">
                <!-- <div class="article-style"> -->
                
                
                <div class="franklin-content">
<div class="tags"><a href="/tag/" id="tag-icon"><svg width="20" height="20" viewBox="0 0 512 512"><defs><style>.cls-1{fill:#141f38}</style></defs><path class="cls-1" d="M215.8 512a76.1 76.1 0 0 1-54.17-22.44L22.44 350.37a76.59 76.59 0 0 1 0-108.32L242 22.44A76.11 76.11 0 0 1 296.2 0h139.2A76.69 76.69 0 0 1 512 76.6v139.19A76.08 76.08 0 0 1 489.56 270L270 489.56A76.09 76.09 0 0 1 215.8 512zm80.4-486.4a50.69 50.69 0 0 0-36.06 14.94l-219.6 219.6a51 51 0 0 0 0 72.13l139.19 139.19a51 51 0 0 0 72.13 0l219.6-219.61a50.67 50.67 0 0 0 14.94-36.06V76.6a51.06 51.06 0 0 0-51-51zm126.44 102.08A38.32 38.32 0 1 1 461 89.36a38.37 38.37 0 0 1-38.36 38.32zm0-51a12.72 12.72 0 1 0 12.72 12.72 12.73 12.73 0 0 0-12.72-12.76z"/><path class="cls-1" d="M217.56 422.4a44.61 44.61 0 0 1-31.76-13.16l-83-83a45 45 0 0 1 0-63.52L211.49 154a44.91 44.91 0 0 1 63.51 0l83 83a45 45 0 0 1 0 63.52L249.31 409.24a44.59 44.59 0 0 1-31.75 13.16zm-96.7-141.61a19.34 19.34 0 0 0 0 27.32l83 83a19.77 19.77 0 0 0 27.31 0l108.77-108.7a19.34 19.34 0 0 0 0-27.32l-83-83a19.77 19.77 0 0 0-27.31 0l-108.77 108.7z"/><path class="cls-1" d="M294.4 281.6a12.75 12.75 0 0 1-9-3.75l-51.2-51.2a12.8 12.8 0 0 1 18.1-18.1l51.2 51.2a12.8 12.8 0 0 1-9.05 21.85zM256 320a12.75 12.75 0 0 1-9.05-3.75l-51.2-51.2a12.8 12.8 0 0 1 18.1-18.1l51.2 51.2A12.8 12.8 0 0 1 256 320zM217.6 358.4a12.75 12.75 0 0 1-9-3.75l-51.2-51.2a12.8 12.8 0 1 1 18.1-18.1l51.2 51.2a12.8 12.8 0 0 1-9.05 21.85z"/></svg></a><a href="/tag/clang/">clang</a>, <a href="/tag/coding/">coding</a>, <a href="/tag/doc/">doc</a>, <a href="/tag/wrapper/">wrapper</a>&nbsp;&nbsp;&nbsp;&nbsp;<a id="tag-icon"><svg width="20" height="20" class="icon" viewBox="0 0 1024 1024" version="1.1" p-id="3825" width="64" height="64"><path d="M512 416a96 96 0 1 0 0 192 96 96 0 0 0 0-192z m511.952 102.064c-0.016-0.448-0.064-0.864-0.096-1.296a8.16 8.16 0 0 0-0.08-0.656c0-0.32-0.064-0.624-0.128-0.928-0.032-0.368-0.064-0.736-0.128-1.088-0.032-0.048-0.032-0.096-0.032-0.144a39.488 39.488 0 0 0-10.704-21.536c-32.672-39.616-71.536-74.88-111.04-107.072-85.088-69.392-182.432-127.424-289.856-150.8-62.112-13.504-124.576-14.064-187.008-2.64-56.784 10.384-111.504 32-162.72 58.784-80.176 41.92-153.392 99.696-217.184 164.48-11.808 11.984-23.552 24.224-34.288 37.248-14.288 17.328-14.288 37.872 0 55.216 32.672 39.616 71.52 74.848 111.04 107.056 85.12 69.392 182.448 127.408 289.888 150.784 62.096 13.504 124.608 14.096 187.008 2.656 56.768-10.4 111.488-32 162.736-58.768 80.176-41.936 153.376-99.696 217.184-164.48 11.792-12 23.536-24.224 34.288-37.248 5.712-5.872 9.456-13.44 10.704-21.568l0.032-0.128a12.592 12.592 0 0 0 0.128-1.088c0.064-0.304 0.096-0.624 0.128-0.928l0.08-0.656 0.096-1.28c0.032-0.656 0.048-1.296 0.048-1.952l-0.096-1.968zM512 704c-106.032 0-192-85.952-192-192s85.952-192 192-192 192 85.968 192 192c0 106.048-85.968 192-192 192z" p-id="3826"></path></svg></a><span id="busuanzi_value_page_pv"></span></div>
<div class="franklin-toc"><ol><li><a href="#å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a></li><li><a href="#ç”Ÿæˆå™¨æ•™ç¨‹">ç”Ÿæˆå™¨æ•™ç¨‹</a><ol><li><a href="#å°è£…jll">å°è£…JLL</a></li><li><a href="#åˆ›å»ºé»˜è®¤ç”Ÿæˆå™¨">åˆ›å»ºé»˜è®¤ç”Ÿæˆå™¨</a></li><li><a href="#è·³è¿‡ç‰¹å®šç¬¦å·">è·³è¿‡ç‰¹å®šç¬¦å·</a></li><li><a href="#è¾“å‡ºå‰é‡å†™è¡¨è¾¾å¼">è¾“å‡ºå‰é‡å†™è¡¨è¾¾å¼</a></li><li><a href="#å¤šå¹³å°é…ç½®">å¤šå¹³å°é…ç½®</a></li><li><a href="#ç±»å‹å¯¹åº”">ç±»å‹å¯¹åº”</a></li></ol></li><li><a href="#libclangæ•™ç¨‹">LibClangæ•™ç¨‹</a><ol><li><a href="#è¾“å‡ºç»“æ„ä¸­çš„å­—æ®µ">è¾“å‡ºç»“æ„ä¸­çš„å­—æ®µ</a></li><li><a href="#å‡½æ•°å‚æ•°å’Œç±»å‹">å‡½æ•°å‚æ•°å’Œç±»å‹</a></li></ol></li></ol></div>
<p>Clang.jlå¯ä»¥ä»Cçš„å¤´æ–‡ä»¶é›†åˆè‡ªåŠ¨åˆ›å»ºCä»£ç åº“çš„juliaåŒ…è£…å™¨, æ”¯æŒä»¥ä¸‹ç±»å‹:</p>
<pre><code class="language-julia"># C      &#61;&gt; Julia
function &#61;&gt; ccal
struct   &#61;&gt; struct
enum     &#61;&gt; Enum, CEnum
union    &#61;&gt; struct
typedef  &#61;&gt; typealias of intrinsic type
# macro  &#40;limited support&#41;
# bitfiled &#40;experimental support&#41;</code></pre>
<h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="header-anchor">å¿«é€Ÿå¼€å§‹</a></h2>
<p>ä»¥ä¸‹ç¤ºä¾‹æ ¹æ®è¾“å…¥çš„Cè¯­è¨€å¤´æ–‡ä»¶<code>include/clang-c/*.h</code>å°è£…æˆ<code>LibClang.jl</code>:</p>
<ol>
<li><p>ç¼–å†™é…ç½®æ–‡ä»¶<code>generator.toml</code></p>
</li>
</ol>
<pre><code class="language-toml">&#91;general&#93;
library_name &#61; &quot;libclang&quot;
output_file_path &#61; &quot;./LibClang.jl&quot;
module_name &#61; &quot;LibClang&quot;
jll_pkg_name &#61; &quot;Clang_jll&quot;
export_symbol_prefixes &#61; &#91;&quot;CX&quot;, &quot;clang_&quot;&#93;</code></pre>
<ol start="2">
<li><p>åŠ è½½é…ç½®æ–‡ä»¶, ç”Ÿæˆå°è£…å™¨</p>
</li>
</ol>
<pre><code class="language-julia">using Clang.Generators
using Clang.LibClang.Clang_jill

cd&#40;@__DIR__&#41;

include_dir &#61; normpath&#40;Clang_jll.artifact_dir, &quot;include&quot;&#41;
clang_dir &#61; joinpath&#40;include_dir, &quot;clang-c&quot;&#41;

options &#61; load_options&#40;joinpath&#40;@__DIR__, &quot;generator.toml&quot;&#41;&#41;
args &#61; get_default_args&#40;&#41;
push&#33;&#40;args, &quot;-I&#36;include_dir&quot;&#41;

headers &#61; &#91;joinpath&#40;clang_dir, header&#41; for header in readdir&#40;clang_dir&#41; if endwith&#40;header, &quot;.h&quot;&#41;&#93;
# headers &#61; detect_headers&#40;clang_dir, args&#41;

ctx &#61; create_context&#40;headers, args, options&#41;

build&#33;&#40;ctx&#41;</code></pre>
<h2 id="ç”Ÿæˆå™¨æ•™ç¨‹"><a href="#ç”Ÿæˆå™¨æ•™ç¨‹" class="header-anchor">ç”Ÿæˆå™¨æ•™ç¨‹</a></h2>
<h3 id="å°è£…jll"><a href="#å°è£…jll" class="header-anchor">å°è£…JLL</a></h3>
<p><code>Clang.jl</code>çš„æœ€å¸¸ç”¨åœºæ™¯æ˜¯å°†Juliaæ¥å£å¯¼å‡ºåˆ°ç”±JLLåŒ…ç®¡ç†çš„Cåº“, JLLåŒ…æä¾›äº†ä¸€ä¸ªå…±äº«åº“, å¯ä»¥ä½¿ç”¨<code>ccall</code>è¯­æ³•è¿›è¡Œè°ƒç”¨ã€‚ åŒ…è£…JLLåŒ…çš„ä¸€èˆ¬æµç¨‹:</p>
<ol>
<li><p>å®šä½Cå¤´æ–‡ä»¶</p>
</li>
<li><p>æŸ¥æ‰¾ç¼–è¯‘å™¨æ ‡è®°</p>
</li>
<li><p>ä½¿ç”¨ç”Ÿæˆå™¨åˆ›å»ºä¸€ä¸ª<code>.toml</code>æ–‡ä»¶</p>
</li>
<li><p>ç”¨ä¸Šè¿°ä¸‰ä¸ªä¿¡æ¯è¿›è¡Œæ„å»º</p>
</li>
<li><p>æµ‹è¯•</p>
</li>
</ol>
<h3 id="åˆ›å»ºé»˜è®¤ç”Ÿæˆå™¨"><a href="#åˆ›å»ºé»˜è®¤ç”Ÿæˆå™¨" class="header-anchor">åˆ›å»ºé»˜è®¤ç”Ÿæˆå™¨</a></h3>
<code>Generator &#61; Headers &#43; Compiler flags &#43; Generator options</code>
<p>Generator option toml æ–‡ä»¶çš„ç¤ºä¾‹å’Œè¯´æ˜:</p>
<fieldset class="code code-plain"><legend class="code-legend code-legend-plain">plain</legend></p>
<pre><code class="language-plaintext">&#91;general&#93;
# it could also be an expression as long as &#96;Meta.parse&#96; can parse this string successfully.
# basically, it should be the &#96;expression&#96; in the following code:
# ccall&#40;&#40;function_name, expression&#41;, returntype, &#40;argtype1, ...&#41;, argvalue1, ...&#41;
library_name &#61; &quot;libclang&quot;

# this entry allows you to specify different library names for different headers.
# in the following example:
# library_names &#61; &#123;&quot;config.h&quot; &#61; &quot;libclang_config&quot;, &quot;libclang_p.*.h&quot; &#61; &quot;libclang_patch&quot;&#125;
# those functions in the &#96;config.h&#96; will be generated as:
# ccall&#40;&#40;function_name, libclang_config&#41;, returntype, &#40;argtype1, ...&#41;, argvalue1, ...&#41;
library_names &#61; &#123;&#125;

# output file path relative to the working directory
output_file_path &#61; &quot;LibClang.jl&quot;

# if these are set, common file &#40;types and constants&#41; and API file &#40;functions&#41; will be separated
# this is for compatibility, so prologue and epilogue are not supported.
# output_api_file_path &#61; &quot;api.jl&quot;
# output_common_file_path &#61; &quot;common.jl&quot;

# if this entry is not empty, the generator will print the code below to the &#96;output_file_path&#96;.
# module module_name
#
# end # module
module_name &#61; &quot;LibClang&quot;

# if this entry is not empty, the generator will print the code below to the &#96;output_file_path&#96;.
# using jll_pkg_name
# export jll_pkg_name
jll_pkg_name &#61; &quot;Clang_jll&quot;

# for packages that have extra JLL package dependencies
jll_pkg_extra &#61; &#91;&#93;

# identifiers that starts with the string listed in this entry will be exported.
export_symbol_prefixes &#61; &#91;&quot;CX&quot;, &quot;clang_&quot;&#93;

# the code in the following file will be copy-pasted to &#96;output_file_path&#96; before the generated code.
# this is often used for applying custom patches, e.g. adding missing definitions.
prologue_file_path &#61; &quot;./prologue.jl&quot;

# the code in the following file will be copy-pasted to &#96;output_file_path&#96; after the generated code.
# this is often used for applying custom patches.
epilogue_file_path &#61; &quot;&quot;

# node with an id in the &#96;output_ignorelist&#96; will be ignored in the printing passes.
# this is very useful for custom editing.
output_ignorelist &#61; &#91;
    &quot;CINDEX_EXPORTS&quot;,
    &quot;CINDEX_VERSION&quot;,
    &quot;CINDEX_VERSION_STRING&quot;,
    &quot;CINDEX_LINKAGE&quot;,
    &quot;CINDEX_DEPRECATED&quot;,
    &quot;LLVM_CLANG_C_STRICT_PROTOTYPES_BEGIN&quot;,
    &quot;LLVM_CLANG_C_STRICT_PROTOTYPES_END&quot;,
    &quot;LLVM_CLANG_C_EXTERN_C_BEGIN&quot;,
    &quot;LLVM_CLANG_C_EXTERN_C_END&quot;
&#93;

# Julia&#39;s &#96;@enum&#96; do not allow duplicated values, so by default, C enums are translated to
# CEnum.jl&#39;s &#96;@cenum&#96;.
# if this entry is true, &#96;@enum&#96; is used and those duplicated enum constants are just commented.
use_julia_native_enum_type &#61; false

# use &#96;@cenum&#96; but do not print &#96;using CEnum&#96;.
# this is useful in the case of using &#96;CEnum&#96; directly in the source tree instead of using &#96;CEnum&#96; as a dependency
print_using_CEnum &#61; true

# Print enums directly as integers without @&#40;c&#41;enum wrapper
# Override above two options
print_enum_as_integer &#61; false

# use deterministic symbol instead of &#96;gensym&#96;-generated &#96;var&quot;##XXX&quot;&#96;
use_deterministic_symbol &#61; true

# by default, only those declarations in the local header file are processed.
# those declarations in the system headers will be treated specially and will be generated if necessary.
# if you&#39;d like to generate all of the symbols in the system headers, please set this option to false.
is_local_header_only &#61; true

# if this option is set to true, C code with a style of
# &#96;&#96;&#96;c
# typedef struct &#123;
#     int x;
# &#125; my_struct;
# &#96;&#96;&#96;
# will be generated as:
# &#96;&#96;&#96;julia
# struct my_struct
#     x::Cint
# end
# &#96;&#96;&#96;
# instead of
# &#96;&#96;&#96;julia
# struct var&quot;##Ctag#NUM&quot;
#     x::Cint
# end
# const my_struct &#61; var&quot;##Ctag#NUM&quot;
# &#96;&#96;&#96;
smart_de_anonymize &#61; true

# if set to true, static functions will be ignored
skip_static_functions &#61; false

# EXPERIMENTAL
# if this option is set to true, those structs that are not necessary to be an
# immutable struct will be generated as a mutable struct.
# this option is default to false, do read the paragraph below before using this feature.
auto_mutability &#61; false

# add inner constructor &#96;Foo&#40;&#41; &#61; new&#40;&#41;&#96;
auto_mutability_with_new &#61; true

# if you feel like certain structs should not be generated as mutable struct, please add them in the following list.
# for example, if a C function accepts a &#96;Vector&#96; of some type as its argument like:
#     void foo&#40;mutable_type *list, int n&#41;;
# when calling this function via &#96;ccall&#96;, passing a &#96;Vector&#123;mutable_type&#125;&#40;undef, n&#41;&#96; to the first
# argument will trigger a crash, the reason is mutable structs are not stored inline within a &#96;Vector&#96;,
# one should use &#96;Ref&#123;NTuple&#123;n,mutable_type&#125;&#125;&#40;&#41;&#96; instead.
# this is not convenient and that&#39;s where the &#96;auto_mutability_ignorelist&#96; comes in.
auto_mutability_ignorelist &#61; &#91;&#93;

# opposite to &#96;auto_mutability_ignorelist&#96; and has a higher priority
auto_mutability_includelist &#61; &#91;&#93;

# if set to &quot;raw&quot;, extract and dump raw c comment;
# if set to &quot;doxygen&quot;, parse and format doxygen comment.
# note: by default, Clang only parses doxygen comment, pass &#96;-fparse-all-comments&#96; to Clang in order to parse non-doxygen comments.
extract_c_comment_style &#61; &quot;doxygen&quot;

# Pass a function to explicitly generate documentation. It will be called like
# &#96;callback_documentation&#40;node::ExprNode&#41;&#96; if &#96;extract_c_comment_style&#96; is not
# set, or if it is set and no docs were found automatically.
#
# Do *not* set this in the TOML file, it should be set in the generator script
# to a function that takes in an ExprNode and returns a String&#91;&#93; &#40;string
# vector&#41;.
# callback_documentation &#61; &quot;&quot;

# if set to true, single line comment will be printed as &quot;&quot;&quot;comment&quot;&quot;&quot; instead of &quot;&quot;&quot;\ncomment\n&quot;&quot;&quot;
fold_single_line_comment &#61; false

# if set to &quot;outofline&quot;, documentation of struct fields will be collected at the &quot;Fields&quot; section of the struct
# if set to &quot;inline&quot;, documentation of struct fields will go right above struct definition
struct_field_comment_style &#61; &quot;outofline&quot;

# if set to &quot;outofline&quot;, documentation of enumerators will be collected at the &quot;Enumerators&quot; section of the enum
enumerator_comment_style &#61; &quot;outofline&quot;

# if set to true, C function prototype will be included in documentation
show_c_function_prototype &#61; false

&#91;codegen&#93;
# map C&#39;s bool to Julia&#39;s Bool instead of &#96;Cuchar&#96; a.k.a &#96;UInt8&#96;.
use_julia_bool &#61; true

# set this to true if the C routine always expects a NUL-terminated string.
# TODO: support filtering
always_NUL_terminated_string &#61; true

# generate strictly typed function
is_function_strictly_typed &#61; false

# if true, opaque pointers in function arguments will be translated to &#96;Ptr&#123;Cvoid&#125;&#96;.
opaque_func_arg_as_PtrCvoid &#61; false

# if true, opaque types are translated to &#96;mutable struct&#96; instead of &#96;Cvoid&#96;.
opaque_as_mutable_struct &#61; true

# if true, use Julia 1.5&#39;s new &#96;@ccall&#96; macro
use_ccall_macro &#61; true

# if true, variadic functions are wrapped with &#96;@ccall&#96; macro. Otherwise variadic functions are ignored.
wrap_variadic_function &#61; false

# generate getproperty/setproperty&#33; methods for the types in the following list
field_access_method_list &#61; &#91;&#93;

# the generator will prefix the function argument names in the following list with a &quot;_&quot; to
# prevent the generated symbols from conflicting with the symbols defined and exported in Base.
function_argument_conflict_symbols &#61; &#91;&#93;

# emit constructors for all custom-layout structs like bitfield in the list,
# or set to &#96;true&#96; to do so for all such structs
add_record_constructors &#61; &#91;&#93;

&#91;codegen.macro&#93;
# itâ€˜s highly recommended to set this entry to &quot;basic&quot;.
# if you&#39;d like to skip all of the macros, please set this entry to &quot;disable&quot;.
# if you&#39;d like to translate function-like macros to Julia, please set this entry to &quot;aggressive&quot;.
macro_mode &#61; &quot;basic&quot;

# function-like macros in the following list will always be translated.
functionlike_macro_includelist &#61; &#91;
    &quot;CINDEX_VERSION_ENCODE&quot;,
&#93;

# if true, the generator prints the following message as comments.
# &quot;# Skipping MacroDefinition: ...&quot;
add_comment_for_skipped_macro &#61; true

# if true, ignore any macros that is suffixed with &quot;_H&quot; or in the &#96;ignore_header_guards_with_suffixes&#96; list
ignore_header_guards &#61; true
ignore_header_guards_with_suffixes &#61; &#91;&#93;

# if true, ignore those pure definition macros in the C code
ignore_pure_definition &#61; true</code></pre>
<p><div class="code-lag">plain</div></fieldset>
<h3 id="è·³è¿‡ç‰¹å®šç¬¦å·"><a href="#è·³è¿‡ç‰¹å®šç¬¦å·" class="header-anchor">è·³è¿‡ç‰¹å®šç¬¦å·</a></h3>
<p>Cå¤´æ–‡ä»¶ä¸­å¯èƒ½æœ‰ä¸€äº›ç¬¦å·ä¸èƒ½æ­£ç¡®åœ°è¢«<code>Clang.jl</code>å¤„ç†, æ­¤æ—¶å¯ä»¥é€‰æ‹©è·³è¿‡è¿™äº›å†…å®¹, å¹¶å¯ä»¥åœ¨åç»­ç”¨<code>prologue_file_path</code>æŒ‡å®š<code>prologue</code>è¿›è¡Œå›å¡«:</p>
<ul>
<li><p>åœ¨<code>output_ignorelist</code>ä¸­æ·»åŠ symbol, ä»è€Œè·³è¿‡å®ƒçš„å°è£…;</p>
</li>
<li><p>å¦‚æœsymbolä½äºç³»ç»Ÿå¤´æ–‡ä»¶, å¯¼è‡´Clang.jlåœ¨è¾“å‡ºå‰æŠ¥é”™, éœ€è¦åœ¨ç”Ÿæˆå‰æ·»åŠ <code>@add_def symbol_name</code>ä»è€Œç¦æ­¢å°è£…, å¹¶åœ¨Clang.jlçš„githubä¸­post issue;</p>
</li>
</ul>
<h3 id="è¾“å‡ºå‰é‡å†™è¡¨è¾¾å¼"><a href="#è¾“å‡ºå‰é‡å†™è¡¨è¾¾å¼" class="header-anchor">è¾“å‡ºå‰é‡å†™è¡¨è¾¾å¼</a></h3>
<p>Clang.jlå°è£…å®é™…ä¸Šåˆ†ä¸ºå°è£…è¿‡ç¨‹å’Œè¾“å‡ºè¿‡ç¨‹ä¸¤éƒ¨åˆ†, å› æ­¤å°è£…çš„è¡¨è¾¾å¼åœ¨è¾“å‡ºåˆ°æ–‡ä»¶ä¹‹å‰, æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„, åªéœ€è¦åˆ†å¼€æ‰§è¡Œä¸¤éƒ¨åˆ†æ­¥éª¤:</p>
<pre><code class="language-julia"># åªå°è£… ä¸è¾“å‡º
build&#33;&#40;ctx, BULDSTAGE_NO_PRINTING&#41;

# è‡ªå®šä¹‰é‡å†™è§„åˆ™
function rewrite&#33;&#40;e::Expr&#41; end
function rewrite&#33;&#40;daag::ExprDAG&#41;
    for node in get_nodes&#40;dag&#41;
        for expr in get_exprs&#40;node&#41;
            rewrite&#33;&#40;expr&#41;
        end
    end
end

rewrite&#33;&#40;ctx,dag&#41;

# è¾“å‡º
build&#33;&#40;ctx, BUILDSTAGE_PRINTING_ONLY&#41;</code></pre>
<h3 id="å¤šå¹³å°é…ç½®"><a href="#å¤šå¹³å°é…ç½®" class="header-anchor">å¤šå¹³å°é…ç½®</a></h3>
<ul>
<li><p>å½“ä¸€äº›æ•°æ®ç±»å‹å¯èƒ½ä¸ç³»ç»Ÿç›¸å…³æ—¶, å¯ä»¥è·³è¿‡, ç„¶åæ‰‹åŠ¨é‡æ–°æ·»åŠ ;</p>
</li>
<li><p>å¦‚æœå·®å¼‚å¤ªå¤§æ— æ³•æ‰‹åŠ¨ä¿®å¤, å¯ä»¥ä¸ºæ¯ä¸ªå¹³å°ç”Ÿæˆå°è£…, å¦‚<a href="https://github.com/Gnimuc/LibClang.jl/blob/v0.61.0/gen/generator.jl" target="_blank" rel="noopener noreferrer"> LibClang.jl</a>ä¸­æ‰€ç¤º</p>
</li>
</ul>
<h3 id="ç±»å‹å¯¹åº”"><a href="#ç±»å‹å¯¹åº”" class="header-anchor">ç±»å‹å¯¹åº”</a></h3>
<table><tr><th align="left">C type</th><th align="left">ccall signature</th><th align="left">Julia type</th></tr><tr><td align="left">Int/Float</td><td align="left">the same</td><td align="left">the sam</td></tr><tr><td align="left">Struct T</td><td align="left">åœ¨juliaä¸­æ„é€ ä¸€ä¸ªåŒæ ·ç»“æ„çš„T</td><td align="left">T</td></tr><tr><td align="left">Pointer&#40;T*&#41;</td><td align="left">Ref&#123;T&#125;/Ptr&#123;T&#125;</td><td align="left">Ref&#123;T&#125;/Ptr&#123;T&#125;/array</td></tr><tr><td align="left">Strin&#40;char*&#41;</td><td align="left">Cstring/Ptr&#123;Cchar&#125;</td><td align="left">String</td></tr></table>
<ul>
<li><p><code>Ref</code>åœ¨Juliaä¸­æ˜¯æŠ½è±¡ç±»å‹, ä¸èƒ½ç›´æ¥ä¼ é€’ç»™C</p>
</li>
<li><p>å¦‚æœè¦å°†Juliaçš„å­—ç¬¦ä¸²æˆ–æ•°ç»„ä¼ é€’ç»™C, éœ€è¦å°†ç±»å‹æ³¨é‡Šä¸º<code>Ptr&#123;T&#125;</code>, å¦åˆ™ä¼ é€’çš„æ˜¯ç±»å‹ä¿¡æ¯è€Œä¸æ˜¯bufferä¸­çš„å†…å®¹ç»“æ„, æœ‰ä¸¤ç§æ–¹æ³•èƒ½å®ç°:</p>
<ol>
<li><p>ç”¨<code>@ccall</code>: <code>@ccal printf&#40;&quot;&#37;s\n&quot;; &quot;hello&quot;::Cstring&#41;::Cint</code></p>
</li>
<li><p>é‡è½½<code>to_c_type</code>ä»è€Œå°†Juliaç±»å‹æ˜ å°„åˆ°å¯¹åº”çš„call signatureç±»å‹: å°†<code>to_c_type&#40;::Type&#123;String&#125;&#41; &#61; Cstring</code>æ·»åŠ åˆ°prologueä¿¡æ¯ä¸­, ä¹‹åæ‰€æœ‰çš„<code>String</code>éƒ½å°†è¢«æ³¨é‡Šä¸º<code>Cstring</code>:</p>
</li>
</ol>
</li>
</ul>
<div class="indent-block" style="margin-left: 4em !important"></p>
<pre><code class="language-julia">to_c_type&#40;::Type&#123;&lt;:AbstractString&gt;&#125;&#41; &#61; Cstring # æˆ–è€… Ptr&#123;Cchar&#125;
to_c_type&#40;t::Type&#123;&lt;:Union&#123;AbstractArray, Ref&#125;&#125;&#41; &#61; Ptr&#123;eltype&#40;t&#41;&#125;</code></pre>
<p></div>
<h2 id="libclangæ•™ç¨‹"><a href="#libclangæ•™ç¨‹" class="header-anchor">LibClangæ•™ç¨‹</a></h2>
<p>Clangæ˜¯åŸºäºLLVMæ¡†æ¶çš„å¼€æºç¼–è¯‘å™¨, æ˜¯ç°ä»£åŒ–çš„C, C&#43;&#43;å’ŒObjective-Cç¼–è¯‘å™¨, Clangå’ŒLLVMæ˜¯ç”¨C&#43;&#43;å†™çš„, ä½†æ˜¯Clangé¡¹ç›®ç»´æŠ¤äº†ä¸€ä¸ªåä¸º<code>libclang</code>çš„Cæ¥å£, æä¾›å¯¹ASTå’Œç±»å‹è¡¨ç¤ºçš„è®¿é—®ã€‚</p>
<p>Clang.jlå°è£…äº†<code>libclang</code>, å¹¶æä¾›äº†ä¸€ä¸ª<code>C&#61;&gt;Julia</code>çš„å°è£…ç”Ÿæˆå™¨</p>
<p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªç¤ºä¾‹å¤´æ–‡ä»¶çš„å°è£…æ¥è¯´æ˜:</p>
<pre><code class="language-C">//example.h
struct ExStruct &#123;
    int    kind;
    char*  name;
    float* data;
&#125;;

void* ExFunction &#40;int kind, char* name, float* data&#41;&#123;
    struct ExStruct st;
    st.kind &#61; kind;
    st.name &#61; name;
    st.data &#61; data;
&#125;</code></pre>
<h3 id="è¾“å‡ºç»“æ„ä¸­çš„å­—æ®µ"><a href="#è¾“å‡ºç»“æ„ä¸­çš„å­—æ®µ" class="header-anchor">è¾“å‡ºç»“æ„ä¸­çš„å­—æ®µ</a></h3>
<p>ç”¨Clang.jlè§£æä¸Šè¿°ç»“æ„åªéœ€è¦å‡ è¡Œä»£ç : </p>
<pre><code class="language-julia">using Clang
trans_unit &#61; Clang.parse_header&#40;Index&#40;&#41;, &quot;example.h&quot;&#41;
root_cursor &#61; Clang.getTranslationUnitCursor&#40;trans_unit&#41;
struct_cursor &#61; search&#40;root_cursor, &quot;ExStruct&quot;&#41; |&gt; only

# test
for c in children&#40;struct_cursor&#41;
    println&#40;&quot;Cursor:&quot;, c, 
            &quot;\n Kind: &quot;, kind&#40;c&#41;, 
            &quot;\n Name: &quot;, name&#40;c&#41;, 
            &quot;\n Type: &quot;, Clang.getCursorType&#40;c&#41;&#41;
end</code></pre>
<p><code>trans_unit</code>å­˜å‚¨äº†ä¸€ä¸ª<code>TranslationUnit</code>ç±»å‹çš„libclang ASTæ¥å£, ç”¨æŒ‡é’ˆèŠ‚ç‚¹çš„DAGè¡¨ç¤º, åŒ…å«ä¸‰ä¸ªåŸºæœ¬ä¿¡æ¯:</p>
<ul>
<li><p>Kind: æŒ‡é’ˆèŠ‚ç‚¹çš„ç”¨é€”</p>
</li>
<li><p>Type: æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ç±»å‹</p>
</li>
<li><p>Children: å­èŠ‚ç‚¹åˆ—è¡¨</p>
</li>
</ul>
<p><code>root_cursor</code>æ˜¯<code>TranslationUnit</code>çš„æ ¹æŒ‡é’ˆã€‚ Clang.jlä¸­, <code>CLCursor</code>å®šä¹‰äº†æŒ‡é’ˆçš„æŠ½è±¡ç±»å‹, æ‰€æœ‰æŒ‡é’ˆéƒ½ç”±å…¶æ´¾ç”Ÿ, åœ¨åº•å±‚å®ç°æ—¶, æ¯ä¸ªæŒ‡é’ˆ<code>CXCursor</code>å’Œç±»å‹éƒ½æ˜¯<code>enum</code>&#40;å¯æšä¸¾çš„&#41;æ•°å€¼, ç”¨æ¥è‡ªåŠ¨å°†æŒ‡é’ˆä¸Juliaç±»å‹è¿›è¡Œæ˜ å°„ã€‚å› æ­¤, å¯ä»¥é’ˆå¯¹CLCursoræˆ–CLTypeå˜é‡ç¼–å†™å¤šé‡æ´¾å‘çš„æ–¹æ³•ã€‚</p>
<pre><code class="language-julia">dump&#40;root_cursor&#41;
dump&#40;Clang.LibClang.CXCursorKind&#41; # æŒ‡é’ˆç±»å‹è¢«ç¿»è¯‘æˆCenum

# è®¿é—®æŒ‡é’ˆå­èŠ‚ç‚¹çš„ä¸¤ç§æ–¹æ³•:
# chrildren&#40;&#41;: è¿”å›å­èŠ‚ç‚¹è¿­ä»£å™¨
children&#40;struct_cursor&#41;

# search&#40;&#41;: è¿”å›ä¸€ä¸ªå­èŠ‚ç‚¹åˆ—è¡¨, å¤§éƒ¨åˆ†æƒ…å†µåº”è¯¥åªè¾“å‡ºä¸€ä¸ªå­èŠ‚ç‚¹, æ‰€ä»¥å¯ä»¥é…åˆonly&#40;&#41;å‡½æ•°åšæ ¡éªŒ
search&#40;root_cursor, &quot;ExStruct&quot;&#41;</code></pre>
<p>æ¯ä¸ª<code>CLFieldDecl</code>æŒ‡é’ˆéƒ½æœ‰ä¸€ä¸ªå…³è”çš„<code>CLType</code>å¯¹è±¡, å¯ä»¥ç”¨<code>type&#40;&#41;</code>å‡½æ•°æŸ¥è¯¢ã€‚</p>
<h3 id="å‡½æ•°å‚æ•°å’Œç±»å‹"><a href="#å‡½æ•°å‚æ•°å’Œç±»å‹" class="header-anchor">å‡½æ•°å‚æ•°å’Œç±»å‹</a></h3>
<p>è¦æ‰¾åˆ°ä¸Šè¿°<code>example.h</code>ä¸­çš„<code>ExFunction</code>å‡½æ•°æŒ‡é’ˆ, æ£€ç´¢<code>CXCursor_FunctionDecl</code>æŒ‡é’ˆç±»å‹çš„èŠ‚ç‚¹:</p>
<pre><code class="language-julia">using Clang.LibClang
fdecl &#61; search&#40;root_cursor, CXCursor_FunctionDecl&#41; |&gt; only

fdecl_children &#61; &#91; c for c in children&#40;fdecl&#41;&#93;</code></pre>
<div class="aadmon aadmon-hack"> æœ‰å…³libclangæä¾›çš„æ‰€æœ‰<code>CLCursor</code>å’Œ<code>CLType</code>çš„ä¿¡æ¯, å‚é˜…<a href="http://clang.llvm.org/doxygen/group__CINDEX.html" target="_blank" rel="noopener noreferrer"> libclangæ–‡æ¡£</a></div>


</div>
<!-- article style -->


 <!-- add comments to page -->
<hr>
<script src="https://utteranc.es/client.js"
    repo="songtaogui/blog_comments"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>

<hr> 

<div class="container">
    
    <footer class="site-footer">
        <p class="powered-by">
          <script type="text/javascript" src="//rf.revolvermaps.com/0/0/4.js?i=5jnkqismgmy&amp;m=5&amp;h=128&amp;c=baff00&amp;r=0" async="async"></script><br>
            Total visits: <span id="busuanzi_value_site_pv"></span>.<br>
            Built with <a href="https://franklinjl.org" target="_blank" rel="noopener">Franklin.jl</a> and <a
                href="https://julialang.org" target="_blank" rel="noopener">Julia</a>.<br>
            Texts are licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.<br>
            Codes are licensed under the <a href="https://mit-license.org/">MIT License</a>.<br>
            <strong>&copy; Songtao Gui</strong>. Last modified: January 02, 2024.
          </p>
    </footer>
    
</div>
</div><!-- control the foot of the page, dynamic load related scripts based on variables in md head -->





</div>

<!--article container -->
</article>


<!-- CONTENT ENDS HERE -->

 <!-- seperate highlight.js so that I can control it with 'hascode=true' in the md file -->
<script src="/libs/highlight/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>
 

<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js
    integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js
    integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js
    integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script>
<script src="/libs/academic/academic.min.js"></script>
<script src="/libs/pure/ui.js"></script>

</body>

 <!-- add back to top button to the end of the page -->
<a class="js-back-to-top back-to-top-button" href="#">
    <img src="/assets/img/up.svg" style="width: 100px;">
</a>
<!-- <button class="js-back-to-top back-to-top-button" title="BackToTop">ï¸½</button> -->
<script src="https://cdn.staticfile.org/jquery/2.2.4/jquery.min.js"></script>
<script>
    $(function () {
        var $win = $(window);
        var $backToTop = $('.js-back-to-top');
        // show the button when the user scrolls past 100 pixels
        $win.scroll(function () {
            if ($win.scrollTop() > 100) {
                $backToTop.show();
            } else {
                $backToTop.hide();
            }
        });
        // when the user clicks on the button, scroll to the top of the document
        $backToTop.click(function () {
            $('html, body').animate({
                scrollTop: 0
            }, 200);
        });
    });
</script>
<style>
    /* back to top button */
    .back-to-top-button {
        display: none;
        position: fixed;
        width: 50px;
        bottom: 3%;
        right: 3%;
        z-index: 99;
        font-size: 15px;
        border: 0px solid #696969;
        background-color: #fff;
        color: #222222;
        outline: none;
        cursor: pointer;
        padding: 7px;
        border-radius: 40px;
    }

    .back-to-top-button:hover {
        background-color: #c0dbf5;
        color: #fff;
    }
</style> 


</html>



